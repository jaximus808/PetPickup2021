"use strict";

var c = require('ansi-colors');

var clfDate = require('clf-date');

var ms = require('ms'); // https://github.com/cabinjs/request-received


var requestReceivedStartTime = Symbol.for('request-received.startTime');
var pinoHttpStartTime = Symbol.for('pino-http.startTime');

function getStartTime(request) {
  var startTime = new Date();
  if (request[requestReceivedStartTime] instanceof Date) startTime = request[requestReceivedStartTime];else if (typeof request[requestReceivedStartTime] === 'number') startTime = new Date(request[requestReceivedStartTime]);else if (request[pinoHttpStartTime]) startTime = new Date(request[pinoHttpStartTime]);else if (request._startTime instanceof Date) startTime = request._startTime;else if (typeof request._startTime === 'number') startTime = new Date(request._startTime);
  return startTime;
}

function apacheCommonLogFormat(options) {
  var req = options.req,
      res = options.res,
      ctx = options.ctx;
  var startTime = getStartTime(req);
  return "".concat(ctx ? ctx.ip : req.ip, " - ").concat(clfDate(startTime), " \"").concat(req.method, " ").concat(req.url, " HTTP/").concat(req.httpVersionMajor, ".").concat(req.httpVersionMinor, "\" ").concat(res.statusCode, " ").concat(res.getHeader('content-length') || '-');
}

function devFriendlyLogFormat(options) {
  var req = options.req,
      res = options.res,
      ctx = options.ctx;
  var statusColor = res.statusCode >= 500 ? 'red' : res.statusCode >= 400 ? 'yellow' : res.statusCode >= 300 ? 'cyan' : res.statusCode >= 200 ? 'green' : 'white';
  var responseTime = '-';
  var responseTimeHeader = res.getHeader('x-response-time');

  if (responseTimeHeader) {
    var milliseconds = ms(responseTimeHeader);
    var responseColor = milliseconds >= 1000 ? 'red' : milliseconds >= 500 ? 'magenta' : milliseconds >= 250 ? 'yellow' : milliseconds >= 100 ? 'cyan' : 'green';
    responseTime = c[responseColor]("".concat(milliseconds, " ms"));
  }

  return [ctx ? ctx.ip : req.ip, req.method, req.url, "HTTP/".concat(req.httpVersionMajor, ".").concat(req.httpVersionMinor), c[statusColor](res.statusCode), res.getHeader('content-length') || '-', '-', responseTime].join(' ');
} // https://stackoverflow.com/questions/9234699/understanding-apaches-access-log


module.exports = function (options) {
  // Apache Common Log Format
  // <https://httpd.apache.org/docs/current/logs.html#common>
  // :remote-addr - :remote-user [:date[clf]] ":method :url HTTP/:http-version" :status :res[content-length]
  if (process.env.NODE_ENV === 'production') return apacheCommonLogFormat(options); // Dev-Friendly Log Format
  // :remote-addr :remote-user :method :url HTTP/:http-version :status :res[content-length] - :response-time ms

  return devFriendlyLogFormat(options);
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tZXNzYWdlLmpzIl0sIm5hbWVzIjpbImMiLCJyZXF1aXJlIiwiY2xmRGF0ZSIsIm1zIiwicmVxdWVzdFJlY2VpdmVkU3RhcnRUaW1lIiwiU3ltYm9sIiwiZm9yIiwicGlub0h0dHBTdGFydFRpbWUiLCJnZXRTdGFydFRpbWUiLCJyZXF1ZXN0Iiwic3RhcnRUaW1lIiwiRGF0ZSIsIl9zdGFydFRpbWUiLCJhcGFjaGVDb21tb25Mb2dGb3JtYXQiLCJvcHRpb25zIiwicmVxIiwicmVzIiwiY3R4IiwiaXAiLCJtZXRob2QiLCJ1cmwiLCJodHRwVmVyc2lvbk1ham9yIiwiaHR0cFZlcnNpb25NaW5vciIsInN0YXR1c0NvZGUiLCJnZXRIZWFkZXIiLCJkZXZGcmllbmRseUxvZ0Zvcm1hdCIsInN0YXR1c0NvbG9yIiwicmVzcG9uc2VUaW1lIiwicmVzcG9uc2VUaW1lSGVhZGVyIiwibWlsbGlzZWNvbmRzIiwicmVzcG9uc2VDb2xvciIsImpvaW4iLCJtb2R1bGUiLCJleHBvcnRzIiwicHJvY2VzcyIsImVudiIsIk5PREVfRU5WIl0sIm1hcHBpbmdzIjoiOztBQUFBLElBQU1BLENBQUMsR0FBR0MsT0FBTyxDQUFDLGFBQUQsQ0FBakI7O0FBQ0EsSUFBTUMsT0FBTyxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUF2Qjs7QUFDQSxJQUFNRSxFQUFFLEdBQUdGLE9BQU8sQ0FBQyxJQUFELENBQWxCLEMsQ0FFQTs7O0FBQ0EsSUFBTUcsd0JBQXdCLEdBQUdDLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXLDRCQUFYLENBQWpDO0FBQ0EsSUFBTUMsaUJBQWlCLEdBQUdGLE1BQU0sQ0FBQ0MsR0FBUCxDQUFXLHFCQUFYLENBQTFCOztBQUVBLFNBQVNFLFlBQVQsQ0FBc0JDLE9BQXRCLEVBQStCO0FBQzdCLE1BQUlDLFNBQVMsR0FBRyxJQUFJQyxJQUFKLEVBQWhCO0FBQ0EsTUFBSUYsT0FBTyxDQUFDTCx3QkFBRCxDQUFQLFlBQTZDTyxJQUFqRCxFQUNFRCxTQUFTLEdBQUdE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MkJOLEdBQUcsQ0FBQ08sZ0JBSi9CLEdBS0x0QixDQUFDLENBQUMwQixXQUFELENBQUQsQ0FBZVYsR0FBRyxDQUFDTyxVQUFuQixDQUxLLEVBTUxQLEdBQUcsQ0FBQ1EsU0FBSixDQUFjLGdCQUFkLEtBQW1DLEdBTjlCLEVBT0wsR0FQSyxFQVFMRyxZQVJLLEVBU0xJLElBVEssQ0FTQSxHQVRBLENBQVA7QUFVRCxDLENBRUQ7OztBQUNBQyxNQUFNLENBQUNDLE9BQVAsR0FBaUIsVUFBQ25CLE9BQUQsRUFBYTtBQUM1QjtBQUNBO0FBQ0E7QUFDQSxNQUFJb0IsT0FBTyxDQUFDQyxHQUFSLENBQVlDLFFBQVosS0FBeUIsWUFBN0IsRUFDRSxPQUFPdkIscUJBQXFCLENBQUNDLE9BQUQsQ0FBNUIsQ0FMMEIsQ0FPNUI7QUFDQTs7QUFDQSxTQUFPVyxvQkFBb0IsQ0FBQ1gsT0FBRCxDQUEzQjtBQUNELENBVkQiLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBjID0gcmVxdWlyZSgnYW5zaS1jb2xvcnMnKTtcbmNvbnN0IGNsZkRhdGUgPSByZXF1aXJlKCdjbGYtZGF0ZScpO1xuY29uc3QgbXMgPSByZXF1aXJlKCdtcycpO1xuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vY2FiaW5qcy9yZXF1ZXN0LXJlY2VpdmVkXG5jb25zdCByZXF1ZXN0UmVjZWl2ZWRTdGFydFRpbWUgPSBTeW1ib2wuZm9yKCdyZXF1ZXN0LXJlY2VpdmVkLnN0YXJ0VGltZScpO1xuY29uc3QgcGlub0h0dHBTdGFydFRpbWUgPSBTeW1ib2wuZm9yKCdwaW5vLWh0dHAuc3RhcnRUaW1lJyk7XG5cbmZ1bmN0aW9uIGdldFN0YXJ0VGltZShyZXF1ZXN0KSB7XG4gIGxldCBzdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuICBpZiAocmVxdWVzdFtyZXF1ZXN0UmVjZWl2ZWRTdGFydFRpbWVdIGluc3RhbmNlb2YgRGF0ZSlcbiAgICBzdGFydFRpbWUgPSByZXF1ZXN0W3JlcXVlc3RSZWNlaXZlZFN0YXJ0VGltZV07XG4gIGVsc2UgaWYgKHR5cGVvZiByZXF1ZXN0W3JlcXVlc3RSZWNlaXZlZFN0YXJ0VGltZV0gPT09ICdudW1iZXInKVxuICAgIHN0YXJ0VGltZSA9IG5ldyBEYXRlKHJlcXVlc3RbcmVxdWVzdFJlY2VpdmVkU3RhcnRUaW1lXSk7XG4gIGVsc2UgaWYgKHJlcXVlc3RbcGlub0h0dHBTdGFydFRpbWVdKVxuICAgIHN0YXJ0VGltZSA9IG5ldyBEYXRlKHJlcXVlc3RbcGlub0h0dHBTdGFydFRpbWVdKTtcbiAgZWxzZSBpZiAocmVxdWVzdC5fc3RhcnRUaW1lIGluc3RhbmNlb2YgRGF0ZSkgc3RhcnRUaW1lID0gcmVxdWVzdC5fc3RhcnRUaW1lO1xuICBlbHNlIGlmICh0eXBlb2YgcmVxdWVzdC5fc3RhcnRUaW1lID09PSAnbnVtYmVyJylcbiAgICBzdGFydFRpbWUgPSBuZXcgRGF0ZShyZXF1ZXN0Ll9zdGFydFRpbWUpO1xuICByZXR1cm4gc3RhcnRUaW1lO1xufVxuXG5mdW5jdGlvbiBhcGFjaGVDb21tb25Mb2dGb3JtYXQob3B0aW9ucykge1xuICBjb25zdCB7IHJlcSwgcmVzLCBjdHggfSA9IG9wdGlvbnM7XG5cbiAgY29uc3Qgc3RhcnRUaW1lID0gZ2V0U3RhcnRUaW1lKHJlcSk7XG5cbiAgcmV0dXJuIGAke2N0eCA/IGN0eC5pcCA6IHJlcS5pcH0gLSAke2NsZkRhdGUoc3RhcnRUaW1lKX0gXCIke3JlcS5tZXRob2R9ICR7XG4gICAgcmVxLnVybFxuICB9IEhUVFAvJHtyZXEuaHR0cFZlcnNpb25NYWpvcn0uJHtyZXEuaHR0cFZlcnNpb25NaW5vcn1cIiAke3Jlcy5zdGF0dXNDb2RlfSAke1xuICAgIHJlcy5nZXRIZWFkZXIoJ2NvbnRlbnQtbGVuZ3RoJykgfHwgJy0nXG4gIH1gO1xufVxuXG5mdW5jdGlvbiBkZXZGcmllbmRseUxvZ0Zvcm1hdChvcHRpb25zKSB7XG4gIGNvbnN0IHsgcmVxLCByZXMsIGN0eCB9ID0gb3B0aW9ucztcblxuICBjb25zdCBzdGF0dXNDb2xvciA9XG4gICAgcmVzLnN0YXR1c0NvZGUgPj0gNTAwXG4gICAgICA/ICdyZWQnXG4gICAgICA6IHJlcy5zdGF0dXNDb2RlID49IDQwMFxuICAgICAgPyAneWVsbG93J1xuICAgICAgOiByZXMuc3RhdHVzQ29kZSA+PSAzMDBcbiAgICAgID8gJ2N5YW4nXG4gICAgICA6IHJlcy5zdGF0dXNDb2RlID49IDIwMFxuICAgICAgPyAnZ3JlZW4nXG4gICAgICA6ICd3aGl0ZSc7XG5cbiAgbGV0IHJlc3BvbnNlVGltZSA9ICctJztcblxuICBjb25zdCByZXNwb25zZVRpbWVIZWFkZXIgPSByZXMuZ2V0SGVhZGVyKCd4LXJlc3BvbnNlLXRpbWUnKTtcbiAgaWYgKHJlc3BvbnNlVGltZUhlYWRlcikge1xuICAgIGNvbnN0IG1pbGxpc2Vjb25kcyA9IG1zKHJlc3BvbnNlVGltZUhlYWRlcik7XG4gICAgY29uc3QgcmVzcG9uc2VDb2xvciA9XG4gICAgICBtaWxsaXNlY29uZHMgPj0gMTAwMFxuICAgICAgICA/ICdyZWQnXG4gICAgICAgIDogbWlsbGlzZWNvbmRzID49IDUwMFxuICAgICAgICA/ICdtYWdlbnRhJ1xuICAgICAgICA6IG1pbGxpc2Vjb25kcyA+PSAyNTBcbiAgICAgICAgPyAneWVsbG93J1xuICAgICAgICA6IG1pbGxpc2Vjb25kcyA+PSAxMDBcbiAgICAgICAgPyAnY3lhbidcbiAgICAgICAgOiAnZ3JlZW4nO1xuICAgIHJlc3BvbnNlVGltZSA9IGNbcmVzcG9uc2VDb2xvcl0oYCR7bWlsbGlzZWNvbmRzfSBtc2ApO1xuICB9XG5cbiAgcmV0dXJuIFtcbiAgICBjdHggPyBjdHguaXAgOiByZXEuaXAsXG4gICAgcmVxLm1ldGhvZCxcbiAgICByZXEudXJsLFxuICAgIGBIVFRQLyR7cmVxLmh0dHBWZXJzaW9uTWFqb3J9LiR7cmVxLmh0dHBWZXJzaW9uTWlub3J9YCxcbiAgICBjW3N0YXR1c0NvbG9yXShyZXMuc3RhdHVzQ29kZSksXG4gICAgcmVzLmdldEhlYWRlcignY29udGVudC1sZW5ndGgnKSB8fCAnLScsXG4gICAgJy0nLFxuICAgIHJlc3BvbnNlVGltZVxuICBdLmpvaW4oJyAnKTtcbn1cblxuLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTIzNDY5OS91bmRlcnN0YW5kaW5nLWFwYWNoZXMtYWNjZXNzLWxvZ1xubW9kdWxlLmV4cG9ydHMgPSAob3B0aW9ucykgPT4ge1xuICAvLyBBcGFjaGUgQ29tbW9uIExvZyBGb3JtYXRcbiAgLy8gPGh0dHBzOi8vaHR0cGQuYXBhY2hlLm9yZy9kb2NzL2N1cnJlbnQvbG9ncy5odG1sI2NvbW1vbj5cbiAgLy8gOnJlbW90ZS1hZGRyIC0gOnJlbW90ZS11c2VyIFs6ZGF0ZVtjbGZdXSBcIjptZXRob2QgOnVybCBIVFRQLzpodHRwLXZlcnNpb25cIiA6c3RhdHVzIDpyZXNbY29udGVudC1sZW5ndGhdXG4gIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKVxuICAgIHJldHVybiBhcGFjaGVDb21tb25Mb2dGb3JtYXQob3B0aW9ucyk7XG5cbiAgLy8gRGV2LUZyaWVuZGx5IExvZyBGb3JtYXRcbiAgLy8gOnJlbW90ZS1hZGRyIDpyZW1vdGUtdXNlciA6bWV0aG9kIDp1cmwgSFRUUC86aHR0cC12ZXJzaW9uIDpzdGF0dXMgOnJlc1tjb250ZW50LWxlbmd0aF0gLSA6cmVzcG9uc2UtdGltZSBtc1xuICByZXR1cm4gZGV2RnJpZW5kbHlMb2dGb3JtYXQob3B0aW9ucyk7XG59O1xuIl19